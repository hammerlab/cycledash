setup: |
    gulp prod
    ./tests/pdifftests/create-test-db.sh
    ./tests/pdifftests/start-cycledash.sh

waitFor:
    url: http://localhost:5001/about
    timeout_secs: 30

aliases:
  - &std-config
      viewportSize:
        width: 1280
        height: 800
      injectCss: |
        body {
          background-color: white;
        }

tests:
  - name: examine
    description: Initial view of a fully-loaded Examine page.
    url: http://localhost:5001/runs/1/examine
    config:
      <<: *std-config

  - name: examine-sorted
    description: Examine page sorted by decreasing Normal Read Depth
    url: http://localhost:5001/runs/1/examine
    config:
      <<: *std-config
      injectJs: |
        c = document.createEvent('MouseEvent');
        c.initMouseEvent('click', true, true, window);
        $('[data-attribute="sample:RD"] a').get(0).dispatchEvent(c);

  - name: examine-tooltip
    description: Examine page showing a Normal Read Depth tooltip
    url: http://localhost:5001/runs/1/examine
    config:
      <<: *std-config
      injectJs: |
        $('[data-attribute="sample:RD"] .tooltip').show();

  - name: examine-filter
    description: Examine page showing a filtered view
    url: http://localhost:5001/runs/1/examine?query=%7B%22range%22%3A%7B%22start%22%3Anull%2C%22end%22%3Anull%2C%22contig%22%3Anull%7D%2C%22filters%22%3A%5B%7B%22filterValue%22%3A%22NORMAL%22%2C%22columnName%22%3A%22sample_name%22%2C%22type%22%3A%22%3D%22%7D%2C%7B%22filterValue%22%3A%2250%22%2C%22columnName%22%3A%22info%3ADP%22%2C%22type%22%3A%22%3E%22%7D%5D%2C%22sortBy%22%3A%5B%7B%22order%22%3A%22asc%22%2C%22columnName%22%3A%22info%3ADP%22%7D%2C%7B%22order%22%3A%22desc%22%2C%22columnName%22%3A%22sample%3ARD%22%7D%5D%2C%22page%22%3A0%2C%22limit%22%3A250%7D
    config:
      <<: *std-config

  - name: runs
    description: Initial view of the runs page
    url: http://localhost:5001/
    config:
      <<: *std-config

  - name: runs-info
    description: Showing an expanded run row and information
    url: http://localhost:5001/
    config:
      <<: *std-config
      injectJs: |
        c = document.createEvent('MouseEvent');
        c.initMouseEvent('click', true, true, window);
        $('tr.run').get(0).dispatchEvent(c);

  - name: validated-run
    description: Examine page showing a run with associated validation data.
    url: http://localhost:5001/runs/2/examine
    config:
      <<: *std-config

  - name: validated-run-with-filter
    description: Same as "validated-run", but with a filter applied.
    url: http://localhost:5001/runs/2/examine?query=%7B%22range%22%3A%7B%22start%22%3Anull%2C%22end%22%3Anull%2C%22contig%22%3Anull%7D%2C%22filters%22%3A%5B%7B%22filterValue%22%3A%22G%22%2C%22columnName%22%3A%22reference%22%2C%22type%22%3A%22%3D%22%7D%5D%2C%22sortBy%22%3A%5B%7B%22columnName%22%3A%22contig%22%2C%22order%22%3A%22asc%22%7D%2C%7B%22columnName%22%3A%22position%22%2C%22order%22%3A%22asc%22%7D%5D%2C%22page%22%3A0%2C%22limit%22%3A250%7D
    config:
      <<: *std-config
